!function(e){"use strict";function i(){var e,i=document.createElement("fakeelement"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"otransitionend",transition:"transitionend"};for(e in t)if(t.hasOwnProperty(e)&&void 0!==i.style[e])return t[e]}function t(e){return this.figure=e,this.lastWindowWidth=window.innerWidth,this.viewerOpen=!1,this.transitionEndEvent=i(),this.load(),this.figure.className.indexOf("viewer")>=0&&this.figure.addEventListener("click",this.openViewer.bind(this)),this}t.prototype.closeViewer=function(){window.removeEventListener("scroll",this.onScroll),this.figure.addEventListener(this.transitionEndEvent,function(){-1==document.body.className.indexOf("viewer-open")&&(this.viewerOpen=!1,this.figure.style.zIndex="")}.bind(this)),document.body.className=document.body.className.replace("viewer-open","").replace(/^\s+|\s+$/g,""),this.figure.style.transform=""},t.prototype.openViewer=function(){if(document.body.className.indexOf("viewer-open")>=0)return void this.closeViewer();this.viewerOpen=!0;var e,i,t,n=window.getComputedStyle(this.figure),s=parseFloat(n.height),o=parseFloat(n.width),r=window.innerHeight,a=window.innerWidth,d=this.figure.getBoundingClientRect(),l=o/s,h=a/r;if(h>=l){e=r/s;var u=o*e;i=(a-u)/2-d.left,t=-1*d.top}else{e=a/o;var f=s*e;t=(r-f)/2-d.top,i=-1*d.left}document.body.className+=" viewer-open",this.figure.style.zIndex="800",this.figure.style.transform="translate3d("+i+"px,"+t+"px,0) scale("+e+")",setTimeout(function(){this.lastWindowWidth<1440&&this.loadRaw()}.bind(this),300),this.onScroll=function(){var e=this.figure.getBoundingClientRect().top;Math.abs(e)>50&&this.closeViewer()}.bind(this),window.addEventListener("scroll",this.onScroll)},t.prototype.load=function(){var e=new Image;e.src=this.figure.dataset[this.getSize()],e.className="full",e.onload=function(){this.figure.className+=" loaded"}.bind(this),this.figure.appendChild(e)},t.prototype.loadRaw=function(){var e=new Image;e.src=this.figure.dataset.large,e.className="raw",e.onload=function(){this.figure.className+=" loaded-raw"}.bind(this),this.figure.appendChild(e)},t.prototype.getSize=function(){return this.lastWindowWidth<768?"small":this.lastWindowWidth<1440?"medium":"large"},"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t:e.ProgressiveImage=t}(this);